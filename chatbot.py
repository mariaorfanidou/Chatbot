import unicodedata
import difflib
from tabulate import tabulate

# Αφαίρεση τόνων
def remove_accents(text):
    return ''.join(
        c for c in unicodedata.normalize('NFD', text)
        if unicodedata.category(c) != 'Mn'
    )

# Λεξικό με απαντήσεις για κάθε θέμα
answers = {
    "στείρωση": "Η ιδανική ηλικία για να στειρώσετε τη γάτα σας είναι συνήθως μεταξύ 4 και 6 μηνών. Για τις θηλυκές γάτες, αυτό συμβαίνει πριν φτάσουν σε σεξουαλική ωριμότητα, η οποία είναι περίπου 6-7 μηνών. Οι αρσενικοί γάτοι μπορούν επίσης να στειρωθούν από 4 μηνών. ",
    "μωρα": "Μια γατα μπορεί να γεννήσει μωρά γατάκια από 4 μηνών. Η γέννα συνήθως διαρκεί 63-65 ημέρες. Τα γατάκια είναι έτοιμα για υιοθεσία όταν είναι τουλάχιστον 8 εβδομάδων. Μια γατα μπορει να γεννήσει 2-6 γατάκια ανά γέννα, αν και αυτό μπορεί να διαφέρει ανάλογα με τη φυλή και την υγεία της γάτας.",
    "τσίπ": "Το τσιπ ειναι ασφαλές και μένει στη γάτα για όλη της τη ζωή. Είναι υποχρεωτικό από το κράτος για τον καλύτερο εντοπισμό τηα γάτας σε πρίπτωση που χαθεί",
    "εμβόλια": "Στη χώρα μας, ο ετήσιος εμβολιασμός κατά της λύσσας είναι υποχρεωτικός για τις γάτες. Επιπλέον, τα βασικά εμβόλια που συνιστώνται είναι αυτά για τη γρίπη της γάτας, τον ιό πανλευκοπενίας αιλουροειδών και τον ιό λευχαιμίας αιλουροειδών. Η πρώτη δόση των βασικών εμβολίων χορηγείται συνήθως σε ηλικία 8-9 εβδομάδων, με επαναληπτική δόση 3-4 εβδομάδες αργότερα. Συνιστάται να συμβουλευτείτε τον κτηνίατρο σας για το πρόγραμμα εμβολιασμού της γάτας σας.",
    "παράσιτα": "Η αντιμετώπιση των παρασίτων στις γάτες απαιτεί μια συνδυασμένη προσέγγιση, συμπεριλαμβανομένης της φαρμακευτικής αγωγής, της πρόληψης και της υγιεινής. Η επιλογή των κατάλληλων προϊόντων αντιπαρασιτικής αγωγής, η τακτική βούρτσισα και το μπάνιο, καθώς και οι επισκέψεις στον κτηνίατρο είναι απαραίτητες για να κρατήσετε τη γάτα σας υγιή.",
    "υιοθεσία": "Η υιοθεσία γάτας είναι μια υπέροχη απόφαση! Βεβαιωθείτε ότι έχετε χώρο, χρόνο και πόρους για να φροντίσετε τη γάτα σας. Επισκεφθείτε τοπικά καταφύγια ή οργανώσεις διάσωσης για να βρείτε την κατάλληλη γάτα για εσάς.",
    "κτηνίατρος": "Ο κτηνίατρος είναι ο ειδικός που θα σας καθοδηγήσει για την υγεία της γάτας σας. Συνιστάται να επισκέπτεστε τον κτηνίατρο τουλάχιστον μία φορά το χρόνο για προληπτική φροντίδα και εμβολιασμούς.",
    "παραπάνω": "Για παραπάνω πληροφορίες και πριν προχωρήσετε σε οποιαδήποτε ενέργεια επικοινωνήστε με τον κτηνιατρό σας.",
    "βιβλιαριο": "Το βιβλιάριο υγείας της γάτας σας είναι σημαντικό για την παρακολούθηση των εμβολιασμών και της γενικής υγείας της. Βεβαιωθείτε ότι το έχετε ενημερωμένο και το κρατάτε σε ασφαλές μέρος.",
    "φιλοζωική": "Η φιλοζωική είναι μια υπέροχη πρωτοβουλία! Υποστηρίξτε τις τοπικές οργανώσεις διάσωσης και υιοθεσίας γατών, προσφέροντας βοήθεια, πόρους ή υιοθετώντας μια γάτα.",
    "απόδραση": "Αν η γάτα σας έχει αποδράσει, προσπαθήστε να την εντοπίσετε άμεσα. Χρησιμοποιήστε το τσιπ της για να την βρείτε και ενημερώστε τις τοπικές αρχές και φιλοζωικές οργανώσεις.",
    "παιχνιδια": "Τα παιχνίδια είναι σημαντικά για τη διασκέδαση και την άσκηση της γάτας σας. Επιλέξτε ασφαλή και κατάλληλα παιχνίδια για γάτες, όπως μπάλες, φτερά και παιχνίδια με ήχο.",
    "διαθεση": "Η διάθεση της γάτας σας μπορεί να επηρεαστεί από πολλούς παράγοντες, όπως η υγεία, το περιβάλλον και η κοινωνικοποίηση. Παρακολουθήστε τη συμπεριφορά της και συμβουλευτείτε τον κτηνίατρο αν παρατηρήσετε αλλαγές.",
    "διατροφή": "Η σωστή διατροφή είναι κρίσιμη για την υγεία της γάτας σας. Επιλέξτε τροφές υψηλής ποιότητας, κατάλληλες για την ηλικία και τις ανάγκες της γάτας σας. Συμβουλευτείτε τον κτηνίατρο για τις καλύτερες επιλογές.",
    "διαβατηριο": "Το διαβατήριο γάτας είναι απαραίτητο για ταξίδια στο εξωτερικό. Περιλαμβάνει πληροφορίες για την υγεία της γάτας, τα εμβόλια και το τσιπ. Βεβαιωθείτε ότι έχετε όλα τα απαραίτητα έγγραφα πριν το ταξίδι.",
    "διαρκεια": "Η διαρκεία της ζωής μιας γάτας εξαρτάται από πολλούς παράγοντες, όπως η φυλή, η υγεία και η φροντίδα. Σε γενικές γραμμές, οι γάτες ζουν κατά μέσο όρο 12-15 χρόνια, αλλά με καλή φροντίδα μπορούν να ζήσουν και πάνω από 20 χρόνια.",
    "γυν δημοφιλη ονοματα": "Τα δημοφιλή ονόματα για γάτες περιλαμβάνουν: Μίσα, Λούνα, Τζίντζερ, Σίσι, Μάγια, Τίνα, Μόλλυ, Κίρα, Νάλα, Εμιλυ. Επιλέξτε ένα όνομα που ταιριάζει στη γάτα σας και την προσωπικότητά της.",
    "ανδ δημοφιλη ονοματα": "Τα δημοφιλή ονόματα για αρσενικές γάτες περιλαμβάνουν: Σιμπα, Τζακ, Λίο, Ρόνι, Τζέρι, Ρόκι, Σιλβεστρο, Τζέιμι, Μπράντλεϊ. Επιλέξτε ένα όνομα που ταιριάζει στη γάτα σας και την προσωπικότητά της.",
    "εκπαίδευση": "Η εκπαίδευση γάτας μπορεί να περιλαμβάνει βασικές εντολές, όπως 'κάτσε', 'έλα' και 'μη'. Χρησιμοποιήστε θετική ενίσχυση, όπως λιχουδιές και επαίνους, για να ενθαρρύνετε τη γάτα σας να μάθει. Η υπομονή και η συνέπεια είναι κλειδιά για την επιτυχία.",
    "μπανιο": "Το μπάνιο της γάτας δεν είναι συνήθως απαραίτητο, καθώς οι γάτες είναι φυσικά καθαρές. Ωστόσο, αν χρειαστεί, χρησιμοποιήστε ειδικό σαμπουάν για γάτες και βεβαιωθείτε ότι η γάτα σας είναι άνετη με το νερό. Αποφύγετε τη χρήση ανθρώπινων σαμπουάν, καθώς μπορεί να ερεθίσουν το δέρμα της.",
    "καθαρισμος σπιτιου": "Ο καθαρισμός του σπιτιού είναι σημαντικός για την υγιεινή και την ευημερία της γάτας σας. Χρησιμοποιήστε ασφαλή καθαριστικά και βεβαιωθείτε ότι δεν υπάρχουν επικίνδυνα αντικείμενα ή ουσίες στο περιβάλλον της γάτας σας. Τακτικός καθαρισμός της άμμου και των παιχνιδιών της γάτας είναι επίσης απαραίτητος.",
    "αρρωστια": "Αν η γάτα σας εμφανίζει συμπτώματα αρρώστιας, όπως απώλεια όρεξης, εμετό, διάρροια ή αλλαγές στη συμπεριφορά, επικοινωνήστε άμεσα με τον κτηνίατρο. Η έγκαιρη διάγνωση και θεραπεία είναι κρίσιμη για την υγεία της γάτας σας.",
    "αμμος": "Η άμμος για γάτες είναι απαραίτητη για την υγιεινή τους. Επιλέξτε άμμο που απορροφά καλά τις οσμές και είναι ασφαλής για τη γάτα σας. Τακτικός καθαρισμός της άμμου είναι σημαντικός για την υγιεινή και την ευημερία της γάτας σας.",
    "βαρος": "Το βάρος της γάτας σας είναι σημαντικό για την υγεία της. Παρακολουθήστε το βάρος της γάτας σας και βεβαιωθείτε ότι διατηρείται σε υγιές επίπεδο. Η υπερβολική παχυσαρκία μπορεί να προκαλέσει προβλήματα υγείας, όπως διαβήτη και αρθρίτιδα. Συμβουλευτείτε τον κτηνίατρο για τις καλύτερες πρακτικές διατροφής και άσκησης.",
    "μοναξια": "Η μοναξιά μπορεί να επηρεάσει τη διάθεση και την ευημερία της γάτας σας. Αν η γάτα σας μένει μόνη για πολλές ώρες, σκεφτείτε να της παρέχετε συντροφιά, όπως ένα άλλο κατοικίδιο ή παιχνίδια που θα την απασχολούν. Η κοινωνικοποίηση και η αλληλεπίδραση με τους ανθρώπους είναι σημαντικές για την ψυχική υγεία της γάτας σας.",
    "νυχια": "Η φροντίδα των νυχιών της γάτας σας είναι σημαντική για την υγιεινή και την ευημερία της. Κόψτε τα νύχια της γάτας σας τακτικά, χρησιμοποιώντας ειδικά εργαλεία για γάτες. Αν δεν είστε σίγουροι πώς να το κάνετε, ζητήστε βοήθεια από τον κτηνίατρο ή έναν επαγγελματία groomer.",
    "φροντιδα": "Η φροντίδα της γάτας σας περιλαμβάνει τη σωστή διατροφή, την υγιεινή, την άσκηση και την κοινωνικοποίηση. Βεβαιωθείτε ότι η γάτα σας έχει πρόσβαση σε καθαρό νερό, υγιεινή τροφή και ασφαλές περιβάλλον. Τακτικές επισκέψεις στον κτηνίατρο είναι επίσης απαραίτητες για την παρακολούθηση της υγείας της.",
}

# Λέξεις-κλειδιά που αντιστοιχούν σε κάθε θέμα
keywords = {
    "στείρωση": ["στείρωση", "αναπαραγωγή", "επέμβαση", "αρσενικό", "θυληκό", "σεξουαλική ωριμότητα", "ορμές", "στειρώσω", "ανύσηχο", "συμπεριφορά"],
    "μωρα": ["μωρό", "νεογένητο", "πρώτο","γεννα","γενναει", "μωρα","εβδομάδες", "γατάκι", "μηνών", "εγκυμοσύνη", "γέννα", "γατάκια", "μωρά γάτας", "γατάκι", "μωρά γάτας"],
    "τσίπ": ["τσίπ", "μικροτσιπ", "εντοπισμός", "ατομικός αριθμός", "απώλεια", "εύρεση", "αριθμός τσιπ", "υποχρεωτικό", "κράτος", "ασφαλές", "αποδρασει", "σκασει"],
    "εμβόλια": ["εμβόλια", "ετήσιο", "εμβόλιο", "λύσσα", "βασικά", "γρίπη", "πανλευκοπενία", "λευχαιμία", "υποχρεωτικό"],
    "παράσιτα": ["παράσιτα", "τριχωμα", "μόλυνση", "δερματικό", "φαγούρα", "αποπαρασίτωση", "τσιμπούρι", "ψύλλοι", "σκουλήκια", "τριχοπτωση", "πέφτουν", "κενα τριχών", "αποπαρασιτωσεις", "παράσιτα γάτας", "ξυνεται", "φαγουριζεται"],
    "υιοθεσία": ["υιοθεσία", "βρήκα", "καταφύγιο", "διάσωση", "υιοθετώ", "υιοθετώ γάτα", "υιοθεσία γάτας", "γατάκι", "σπίτι"],
    "κτηνίατρος" :[ "κτηνίατρος", "κτηνιατρο", "γιατρο", "επίσκεψη", "υγειονομική περίθαλψη", "εξέταση", "διατροφή", "ευημερία", "υγεία", "συμβουλές", "βιβλιαριο", "εμβολιασμός", "προληπτική φροντίδα", "γιατρος", "κτηνίατρος"],
    "παραπάνω": ["παραπάνω", "περισσότερα", "επιπλέον", "άλλες πληροφορίες", "περισσότερες λεπτομέρειες", "επεξήγηση", "επιπλέον πληροφορίες", "περισσότερα για", "περισσότερες πληροφορίες", "αλλο"],
    "βιβλιαριο": ["βιβλιαριο", "υγείας", "υγειονομικό", "εμβολιασμός", "ιστορικό", "κτηνίατρος", "υγειονομική περίθαλψη", "υγειονομικό βιβλιάριο", "αρχείο", "υγειονομικό αρχείο", "υγειονομικό βιβλίο"],
    "φιλοζωική": ["φιλοζωική", "οργάνωση", "διάσωση", "υιοθεσία", "βοήθεια", "βοηθησω", "σωσω", "υποστήριξη", "ζωοφιλία", "αγάπη για τα ζώα", "κοινωνική ευθύνη", "ζωοφιλικές οργανώσεις"],
    "απόδραση": ["απόδραση", "εφυγε", "διαφυγή", "χαθεί", "χαθηκε", "χαμένη", "βρέθηκε", "εντοπισμός", "αναζήτηση", "επιστροφή", "αποκατάσταση", "ανακάλυψη", "εχασα", "βρήκα", "αποδραση", "αποδρασεις", "εφυγε"],
    "παιχνιδια": ["παιχνίδια","γυμναστική", "διασκέδαση", "άσκηση", "δραστηριότητες", "παιχνίδι", "παιχνίδια γάτας", "διασκέδαση γάτας", "ασκήσεις γάτας", "παιχνίδια για γάτες", "παιχνίδια με γάτες", "μπάλα", "φτερά", "παιχνίδια με ήχο", "παιχνίδια με φως", "παιχνίδια με μυρωδιά", "μπάλες"],
    "διαθεση": ["διάθεση", "συμπεριφορά", "συναισθήματα", "ψυχολογία", "στεναχώριμενη", "άγχωμενη", "φόβισμενη", "χαρά", "λύπημενη", "ανησυχη", "νευρικότητα", "ανησυχία γάτας", "αγχωμένη γάτα", "χαρούμενη γάτα", "λυπημένη γάτα", "νευρική γάτα"],
    "διατροφή": ["διατροφή", "τροφη", "τροφές", "τροφίμων", "διατροφή γάτας", "τροφές για γάτες", "διατροφή για γάτες", "τροφές υψηλής ποιότητας", "διατροφή υψηλής ποιότητας", "τροφές για γάτες", "διατροφή για γάτες", "υγιεινή διατροφή", "διατροφή γάτας"],
    "διαβατηριο": ["διαβατήριο", "ταξίδι","εξωτερικο" ,"έγγραφα", "υγειονομικό διαβατήριο", "διαβατήριο γάτας", "διαβατήριο για γάτες", "ταξίδι με γάτα", "ταξίδι στο εξωτερικό", "διαβατήριο για ταξίδι", "διαβατήριο για γάτες"], 
    "διαρκεια": ["διάρκεια", "ζουν","ηλικια", "ζησει", "ζωής", "μέσος όρος", "υπολογισμός", "ζωή γάτας", "διάρκεια ζωής γάτας", "μέση διάρκεια ζωής γάτας", "υπολογισμός διάρκειας ζωής γάτας", "πόσο ζει μια γάτα"],
    "γυν δημοφιλη ονοματα": ["δημοφιλή ονόματα", "όνομα", "ονόματα γάτας", "ονόματα για γάτες", "δημοφιλή ονόματα γάτας", "δημοφιλή ονόματα για γάτες", "δημοφιλή ονόματα γατών"],
    "ανδ δημοφιλη ονοματα": ["δημοφιλή ονόματα", "αρσενικά ονόματα", "αρσενικές γάτες", "αρσενικά ονόματα γάτας", "αρσενικά ονόματα για γάτες", "δημοφιλή ονόματα αρσενικών γατών"],
    "εκπαίδευση": ["εκπαίδευση", "κολπα", "κολπο", "εκπαιδευσω", "μάθηση", "εκπαιδευση γατας", "εκπαίδευση γάτας", "βασικές εντολές", "εντολές γάτας", "εκπαίδευση γάτας", "εκπαίδευση για γάτες", "εκπαίδευση γατών"],
    "μπανιο": ["μπάνιο", "λουτρό", "καθαριότητα", "υγιεινή", "μπάνιο γάτας", "λουτρό γάτας", "καθαριότητα γάτας", "υγιεινή γάτας", "μπάνιο για γάτες", "λουτρό για γάτες"],
    "καθαρισμος σπιτιου": ["καθαρισμός", "τρίχα", "τριχες", "υγιεινή", "καθαρισμός σπιτιού", "καθαριότητα σπιτιού", "υγιεινή σπιτιού", "καθαρισμός για γάτες", "καθαριότητα για γάτες", "υγιεινή για γάτες"],
    "αρρωστια":["αρρώστια", "αρρωστη","αρρωστος", "υγεία", "συμπτώματα", "ασθένεια", "αρρώστια γάτας", "υγεία γάτας", "συμπτώματα γάτας", "ασθένειες γάτας", "αρρώστια για γάτες", "εμετο", "εμετός", "διάρροια", "απώλεια όρεξης", "αλλαγές συμπεριφοράς"],
    "αμμος": ["άμμος", "αμμους", "αμμος γατας", "άμμος γάτας", "καθαριότητα άμμου", "υγιεινή άμμου", "άμμος για γάτες", "καθαριότητα άμμου για γάτες", "υγιεινή άμμου για γάτες"],
    "βαρος": ["βάρος", "κιλα","υγιές βάρος", "υγιές βάρος γάτας", "βάρος γάτας", "υγιές βάρος για γάτες", "βάρος για γάτες", "υγιές βάρος για γάτες"],
    "μοναξια": ["μοναξιά", "μόνη", "μόνος", "κοινωνικοποίηση", "συντροφιά", "μοναξιά γάτας", "κοινωνικοποίηση γάτας", "συντροφιά γάτας", "μοναξιά για γάτες", "κοινωνικοποίηση για γάτες", "συντροφιά για γάτες"],
    "νυχια": ["νύχια", "κοψιμο νυχιων", "φροντίδα νυχιών", "κοπή νυχιών", "φροντίδα νυχιών γάτας", "κοπή νυχιών γάτας", "φροντίδα νυχιών για γάτες", "κοπή νυχιών για γάτες"],
    "φροντιδα": ["φροντίδα", "φροντισω", "φροντιδα γατας", "φροντίδα γάτας", "υγιεινή γάτας", "κοινωνικοποίηση γάτας", "υγειονομική περίθαλψη γάτας", "φροντίδα για γάτες", "υγιεινή για γάτες", "διατροφή για γάτες", "άσκηση για γάτες"]
}


def normalize_keywords(original_dict):
    cleaned = {}
    for topic, words in original_dict.items():
        cleaned[topic] = [remove_accents(w.lower()) for w in words]
    return cleaned

keywords = normalize_keywords(keywords)


def find_answer(user_input):
    for topic, synonyms in keywords.items():
        for word in synonyms:
            if word in user_input:
                return answers[topic]

    all_keywords = []
    topic_map = {}
    for topic, words in keywords.items():
        for word in words:
            all_keywords.append(word)
            topic_map[word] = topic

    matches = difflib.get_close_matches(user_input, all_keywords, n=1, cutoff=0.7)
    if matches:
        matched_word = matches[0]
        matched_topic = topic_map[matched_word]
        return f"(Μήπως εννοούσες: '{matched_word}')\n{answers[matched_topic]}"

    return "Bot: Δεν κατάλαβα την ερώτησή σου. Δοκίμασε λέξεις όπως: στειρωση, τσιπ, εμβόλια, κτηνίατρος..."

# Καταγραφή ιστορικού σε αρχείο
def log_to_file(user_text, bot_response, filename="chat_history.txt"):
    with open(filename, "a", encoding="utf-8") as f:
        f.write(f"Εσύ: {user_text}\nBot: {bot_response}\n\n")

# Προβολή ιστορικού σε πίνακα
def read_history(filename="chat_history.txt"):
    try:
        with open(filename, "r", encoding="utf-8") as f:
            lines = f.readlines()

        rows = []
        question, answer = "", ""
        for line in lines:
            line = line.strip()
            if line.startswith("Εσύ:"):
                question = line[5:].strip()
            elif line.startswith("Bot:"):
                answer = line[5:].strip()
                rows.append([question, answer])

        if not rows:
            return "Bot: Δεν βρέθηκαν αποθηκευμένες συνομιλίες."

        return "📜 Ιστορικό συνομιλίας:\n" + tabulate(rows, headers=["Ερώτηση", "Απάντηση"], tablefmt="grid")

    except FileNotFoundError:
        return "Bot: Δεν υπάρχει αρχείο ιστορικού."

# Εκκαθάριση ιστορικού
def clear_history(filename="chat_history.txt"):
    try:
        with open(filename, "w", encoding="utf-8") as f:
            f.write("")
        return "Bot: Το ιστορικό διαγράφηκε επιτυχώς. 🧹"
    except Exception as e:
        return f"Bot: Σφάλμα: {e}"

# Κύριο loop chatbot
def chatbot():
    print("Bot: Ρώτα με για τη γάτα σου! Π.χ. 'Πότε να στειρώσω τη γάτα;'")
    print("Bot: Εντολές: 'ιστορικό' για προβολή | 'καθάρισε' για εκκαθάριση | 'τέλος' για έξοδο")

    while True:
        user_input = input("Εσύ: ").strip()
        cleaned_input = remove_accents(user_input.lower())

        if cleaned_input == remove_accents("τέλος"):
            print("Bot: Αντίο! 🐾")
            log_to_file(user_input, "Αντίο!")
            break

        if cleaned_input == remove_accents("ιστορικό"):
            print(read_history())
            continue

        if cleaned_input == remove_accents("καθάρισε"):
            confirm = input("Bot: Είσαι σίγουρος; Γράψε 'ναι' για επιβεβαίωση: ").strip().lower()
            if remove_accents(confirm) == "ναι":
                print(clear_history())
            else:
                print("Bot: Η εκκαθάριση ακυρώθηκε.")
            continue

        response = find_answer(cleaned_input)
        print(response)
        log_to_file(user_input, response)

# Εκκίνηση
chatbot()
